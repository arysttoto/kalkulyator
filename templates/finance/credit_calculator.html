{% extends "layout.html" %}

{% block title %}
    –ö—Ä–µ–¥–∏—Ç–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä | –†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ –µ–∂–µ–º–µ—Å—è—á–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏
{% endblock %}

{% block meta %}
    <meta name="description" content="–ë—ã—Å—Ç—Ä—ã–π –∫—Ä–µ–¥–∏—Ç–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä. –£–∑–Ω–∞–π—Ç–µ —Å—É–º–º—É –µ–∂–µ–º–µ—Å—è—á–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π, –æ–±—â—É—é –ø–µ—Ä–µ–ø–ª–∞—Ç—É –∏ –∏—Ç–æ–≥–æ–≤—É—é —Å—É–º–º—É –≤—ã–ø–ª–∞—Ç. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –∏–ø–æ—Ç–µ–∫–∏, –∞–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç–∞ –∏ –¥—Ä—É–≥–∏—Ö –∑–∞–π–º–æ–≤.">
    <meta name="keywords" content="–∫—Ä–µ–¥–∏—Ç–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä, —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –∫—Ä–µ–¥–∏—Ç, –ø–ª–∞—Ç–µ–∂–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç—É, –∏–ø–æ—Ç–µ–∫–∞, –∫—Ä–µ–¥–∏—Ç –æ–Ω–ª–∞–π–Ω, –∞–Ω–Ω—É–∏—Ç–µ—Ç–Ω—ã–π –ø–ª–∞—Ç–µ–∂, –∑–∞–π–º, –∫—Ä–µ–¥–∏—Ç–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç">
{% endblock %}

{% block main %}
<header class="bg-primary text-white text-center py-10">
    <div class="container">
        <h1 class="fw-bold">–ö—Ä–µ–¥–∏—Ç–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä üí∞</h1>
        <p class="lead">–†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ —Å—É–º–º—É –µ–∂–µ–º–µ—Å—è—á–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π –∏ –æ–±—â—É—é –ø–µ—Ä–µ–ø–ª–∞—Ç—É –ø–æ –∫—Ä–µ–¥–∏—Ç—É</p>
    </div>
</header>

<main class="container my-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-lg p-4">
                <h2 class="text-center">üî¢ –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫—Ä–µ–¥–∏—Ç–∞</h2>
                <form id="loanForm">
                    <div class="mb-3">
                        <label for="amount" class="form-label">–°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞</label>
                        <div class="input-group">
                            <input type="text" class="form-control number-input" id="amount" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É" required>
                            <select id="currency" class="form-select">
                                <option value="‚Ç∏">‚Ç∏ (–¢–µ–Ω–≥–µ)</option>
                                <option value="$">$ (–î–æ–ª–ª–∞—Ä)</option>
                                <option value="‚Ç¨">‚Ç¨ (–ï–≤—Ä–æ)</option>
                                <option value="‚ÇΩ">‚ÇΩ (–†—É–±–ª—å)</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="rate" class="form-label">–ì–æ–¥–æ–≤–∞—è –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞ (%)</label>
                        <input type="number" class="form-control" id="rate" step="0.1" min="0" max="100" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 12.5" required>
                    </div>
                    <div class="mb-3">
                        <label for="years" class="form-label">–°—Ä–æ–∫ –∫—Ä–µ–¥–∏—Ç–∞ (–ª–µ—Ç)</label>
                        <input type="number" class="form-control" id="years" step="1" min="1" max="50" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 5" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
                </form>
                
                <div class="mt-4 d-none" id="resultContainer">
                    <h4>üí∞ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á—ë—Ç–∞:</h4>
                    <p>üìÖ –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂: <strong id="monthlyPayment">0</strong></p>
                    <p>üíµ –û–±—â–∞—è —Å—É–º–º–∞ –≤—ã–ø–ª–∞—Ç: <strong id="totalPayment">0</strong></p>
                    <p class="text-danger">üí∏ –û–±—â–∞—è –ø–µ—Ä–µ–ø–ª–∞—Ç–∞ –ø–æ –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º: <strong id="totalInterest">0</strong></p>
                    <p class="text-muted">–ü–µ—Ä–µ–ø–ª–∞—Ç–∞ —Å–æ—Å—Ç–∞–≤–∏—Ç <strong id="interestPercentage">0</strong>% –æ—Ç —Å—É–º–º—ã –∫—Ä–µ–¥–∏—Ç–∞.</p>
                </div>
            </div>
        </div>
    </div>

    <section class="mt-5">
        <h2 class="text-center mb-4">–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä?</h2>
        <p>–ù–∞—à –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–Ω–Ω—É–∏—Ç–µ—Ç–Ω—É—é —Ñ–æ—Ä–º—É–ª—É –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –ø–ª–∞—Ç–µ–∂–µ–π, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –±–∞–Ω–∫–æ–≤:</p>
        <pre><code>
    A = P * (r / (1 - (1 + r)^-n))
        </code></pre>
        <ul>
            <li><strong>A</strong> ‚Äì –µ–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂</li>
            <li><strong>P</strong> ‚Äì —Å—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞</li>
            <li><strong>r</strong> ‚Äì –º–µ—Å—è—á–Ω–∞—è –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞ (–≥–æ–¥–æ–≤–∞—è –¥–µ–ª—ë–Ω–Ω–∞—è –Ω–∞ 12)</li>
            <li><strong>n</strong> ‚Äì –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—è—Ü–µ–≤ (—Å—Ä–æ–∫ –∫—Ä–µ–¥–∏—Ç–∞ –≤ –≥–æ–¥–∞—Ö * 12)</li>
        </ul>
        <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –∏–ø–æ—Ç–µ–∫–∏, –∞–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç–∞ –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –∑–∞–π–º–æ–≤.</p>
    </section>
</main>

<script>
function formatInput(input) {
    let value = input.value.replace(/\D/g, ''); 
    value = value.replace(/\B(?=(\d{3})+(?!\d))/g, ' '); 
    input.value = value;
}

document.querySelectorAll('.number-input').forEach(input => {
    input.addEventListener('input', () => formatInput(input));
});

function formatNumber(num, currency) {
    return new Intl.NumberFormat('ru-RU', { style: 'currency', currency: currency, minimumFractionDigits: 2 }).format(num);
}

document.getElementById('loanForm').addEventListener('submit', function(event) {
    event.preventDefault();
    
    const amount = parseFloat(document.getElementById('amount').value.replace(/\s/g, ''));
    const rate = parseFloat(document.getElementById('rate').value) / 100 / 12;
    const years = parseFloat(document.getElementById('years').value);
    const months = years * 12;
    const currencySymbol = document.getElementById('currency').value;

    const currencyMap = { '‚Ç∏': 'KZT', '$': 'USD', '‚Ç¨': 'EUR', '‚ÇΩ': 'RUB' };
    const currencyCode = currencyMap[currencySymbol] || 'KZT';

    if (amount > 0 && rate > 0 && years > 0) {
        const monthlyPayment = (amount * rate) / (1 - Math.pow(1 + rate, -months));
        const totalPayment = monthlyPayment * months;
        const totalInterest = totalPayment - amount;
        const interestPercentage = ((totalInterest / amount) * 100).toFixed(2);

        document.getElementById('monthlyPayment').textContent = formatNumber(monthlyPayment, currencyCode);
        document.getElementById('totalPayment').textContent = formatNumber(totalPayment, currencyCode);
        document.getElementById('totalInterest').textContent = formatNumber(totalInterest, currencyCode);
        document.getElementById('interestPercentage').textContent = interestPercentage;

        document.getElementById('resultContainer').classList.remove('d-none');
    } else {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!');
    }
});
</script>
{% endblock %}
