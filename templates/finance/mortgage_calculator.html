{% extends "layout.html" %}

{% block title %}
    –ò–ø–æ—Ç–µ—á–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä | –†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ –ø–ª–∞—Ç–µ–∂–∏ –ø–æ –∏–ø–æ—Ç–µ–∫–µ
{% endblock %}

{% block meta %}
    <meta name="description" content="–ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ –∏–ø–æ—Ç–µ–∫—É —Å —Ç–æ—á–Ω—ã–º —Ä–∞—Å—á–µ—Ç–æ–º –µ–∂–µ–º–µ—Å—è—á–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π. –í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É, –ø—Ä–æ—Ü–µ–Ω—Ç –∏ —Å—Ä–æ–∫ –∫—Ä–µ–¥–∏—Ç–∞.">
    <meta name="keywords" content="–∏–ø–æ—Ç–µ–∫–∞, –∏–ø–æ—Ç–µ—á–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä, –∏–ø–æ—Ç–µ—á–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –æ–Ω–ª–∞–π–Ω, –∏–ø–æ—Ç–µ—á–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏, –∫—Ä–µ–¥–∏—Ç –Ω–∞ –∂–∏–ª—å–µ">
{% endblock %}

{% block main %}
<header class="bg-primary text-white text-center py-10">
    <div class="container">
        <h1 class="fw-bold">–ò–ø–æ—Ç–µ—á–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä üè°</h1>
        <p class="lead">–ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ –∏–ø–æ—Ç–µ–∫—É –∏ —É–∑–Ω–∞–π—Ç–µ —Ä–∞–∑–º–µ—Ä –ø–ª–∞—Ç–µ–∂–µ–π.</p>
    </div>
</header>

<main class="container my-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-lg p-4">
                <h2 class="text-center">üî¢ –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–ø–æ—Ç–µ–∫–∏</h2>
                <form id="mortgageForm">
                    <div class="mb-3">
                        <label for="homePrice" class="form-label">–°—Ç–æ–∏–º–æ—Å—Ç—å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</label>
                        <div class="input-group">
                            <input type="text" class="form-control number-input" id="homePrice" required>
                            <select id="currency" class="form-select">
                                <option value="‚Ç∏">‚Ç∏ (–¢–µ–Ω–≥–µ)</option>
                                <option value="$">$ (–î–æ–ª–ª–∞—Ä)</option>
                                <option value="‚Ç¨">‚Ç¨ (–ï–≤—Ä–æ)</option>
                                <option value="‚ÇΩ">‚ÇΩ (–†—É–±–ª—å)</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="downPayment" class="form-label">–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å</label>
                        <input type="text" class="form-control number-input" id="downPayment" required>
                    </div>
                    <div class="mb-3">
                        <label for="rate" class="form-label">–ì–æ–¥–æ–≤–∞—è –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞ (%)</label>
                        <input type="number" class="form-control" id="rate" step="0.1" min="0" max="100" required>
                    </div>
                    <div class="mb-3">
                        <label for="years" class="form-label">–°—Ä–æ–∫ –∫—Ä–µ–¥–∏—Ç–∞ (–ª–µ—Ç)</label>
                        <input type="number" class="form-control" id="years" step="1" min="1" max="50" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
                </form>
                
                <div class="mt-4 d-none" id="resultContainer">
                    <h4>üí∞ –í–∞—à–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h4>
                    <p>–°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞: <strong id="loanAmount">0</strong></p>
                    <p>–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂: <strong id="monthlyPayment">0</strong></p>
                    <p>–û–±—â–∞—è –≤—ã–ø–ª–∞—Ç–∞: <strong id="totalPayment">0</strong></p>
                    <p>–ü–µ—Ä–µ–ø–ª–∞—Ç–∞ –ø–æ –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º: <strong id="totalInterest">0</strong></p>
                    <p class="text-muted">–ü–µ—Ä–µ–ø–ª–∞—Ç–∞ —Å–æ—Å—Ç–∞–≤–∏—Ç <strong id="interestPercentage">0</strong>% –æ—Ç —Å—É–º–º—ã –∫—Ä–µ–¥–∏—Ç–∞.</p>
                </div>
            </div>
        </div>
    </div>

    <section class="mt-5">
        <h2 class="text-center mb-4">üìò –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä?</h2>
        <p>–≠—Ç–æ—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Ñ–æ—Ä–º—É–ª—É –∞–Ω–Ω—É–∏—Ç–µ—Ç–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π:</p>
        <p class="fw-bold text-center">M = P * (r * (1 + r)‚Åø) / ((1 + r)‚Åø - 1)</p>
        <ul>
            <li><strong>M</strong> ‚Äî –µ–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂</li>
            <li><strong>P</strong> ‚Äî —Å—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞ (—Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –º–∏–Ω—É—Å –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å)</li>
            <li><strong>r</strong> ‚Äî –º–µ—Å—è—á–Ω–∞—è –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞ (–≥–æ–¥–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ / 12 / 100)</li>
            <li><strong>n</strong> ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—è—Ü–µ–≤ (—Å—Ä–æ–∫ –∫—Ä–µ–¥–∏—Ç–∞ * 12)</li>
        </ul>
        <p>–≠—Ç–∞ —Ñ–æ—Ä–º—É–ª–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–ª–∞—Ç–µ–∂–∏ –Ω–∞ –≤–µ—Å—å —Å—Ä–æ–∫ –∏–ø–æ—Ç–µ–∫–∏.</p>
    </section>
</main>

<script>

function formatInput(input) {
    let value = input.value.replace(/\D/g, '');
    value = value.replace(/\B(?=(\d{3})+(?!\d))/g, ' '); 
    input.value = value;
}

document.querySelectorAll('.number-input').forEach(input => {
    input.addEventListener('input', () => formatInput(input));
});

function formatNumber(num, currency) {
    return new Intl.NumberFormat('ru-RU', { style: 'currency', currency: currency, minimumFractionDigits: 2 }).format(num);
}

document.getElementById('mortgageForm').addEventListener('submit', function(event) {
    event.preventDefault();
    
    const homePrice = parseFloat(document.getElementById('homePrice').value.replace(/\s/g, ''));
    const downPayment = parseFloat(document.getElementById('downPayment').value.replace(/\s/g, ''));
    const rate = parseFloat(document.getElementById('rate').value) / 100 / 12;
    const years = parseFloat(document.getElementById('years').value);
    const months = years * 12;
    const currencySymbol = document.getElementById('currency').value;

    const currencyMap = { '‚Ç∏': 'KZT', '$': 'USD', '‚Ç¨': 'EUR', '‚ÇΩ': 'RUB' };
    const currencyCode = currencyMap[currencySymbol] || 'KZT';

    const loanAmount = homePrice - downPayment;
    
    if (loanAmount > 0 && rate > 0 && years > 0) {
        const monthlyPayment = (loanAmount * rate) / (1 - Math.pow(1 + rate, -months));
        const totalPayment = monthlyPayment * months;
        const totalInterest = totalPayment - loanAmount;
        const interestPercentage = ((totalInterest / loanAmount) * 100).toFixed(2);

        document.getElementById('loanAmount').textContent = formatNumber(loanAmount, currencyCode);
        document.getElementById('monthlyPayment').textContent = formatNumber(monthlyPayment, currencyCode);
        document.getElementById('totalPayment').textContent = formatNumber(totalPayment, currencyCode);
        document.getElementById('totalInterest').textContent = formatNumber(totalInterest, currencyCode);
        document.getElementById('interestPercentage').textContent = interestPercentage;

        document.getElementById('resultContainer').classList.remove('d-none');
    } else {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!');
    }
});
</script>
{% endblock %}
